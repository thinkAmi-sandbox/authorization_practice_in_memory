# ADR-005: リソース範囲 - 1インスタンス1リソース設計と純粋なACL

## ステータス
- **日付**: 2025-08-21
- **状態**: 承認
- **決定者**: プロジェクトチーム

## コンテキスト

ACLシステムの実装において、以下の2つの設計判断が必要である：

1. **リソース管理の範囲**: 1つのACLインスタンスが管理するリソースの数
2. **所有者の扱い**: Unix方式の所有者特権を持つか、純粋なACLとするか

これらの決定は、システムの複雑性と学習のしやすさに大きく影響する。

## 検討したオプション

### リソース管理の範囲

#### オプション1: 複数リソース管理
1つのACLインスタンスで複数のリソースを管理する方式。

- **利点**:
  - 実システムに近い設計
  - リソース間の権限管理を統一的に扱える

- **欠点**:
  - 実装が複雑になる
  - リソースIDの管理が必要
  - 学習目的には過度に複雑

#### オプション2: 1インスタンス1リソース
1つのACLインスタンスが1つのリソースのみを管理する方式。

- **利点**:
  - シンプルで理解しやすい
  - 権限チェックのロジックに集中できる
  - コードが簡潔になる

- **欠点**:
  - 実システムとは異なる設計
  - 複数リソースを扱う場合は複数インスタンスが必要

### 所有者の扱い

#### オプション1: 所有者特権あり（Unix方式）
所有者は常にフルアクセス権を持つ方式。

- **利点**:
  - Unixパーミッションとの一貫性
  - 所有者による完全な制御を保証

- **欠点**:
  - ACLエントリーで所有者を制限できない
  - 純粋なACLの動作を学べない

#### オプション2: 純粋なACL
所有者も他のユーザーと同様にACLエントリーで制御する方式。

- **利点**:
  - より柔軟な権限制御が可能
  - ACL本来の動作を学習できる
  - すべての主体を統一的に扱える

- **欠点**:
  - Unixパーミッションとの違いがある
  - 所有者が自分自身をロックアウトする可能性

## 決定

1. **1インスタンス1リソース設計（オプション2）**を採用する
2. **純粋なACL（オプション2）**を採用する

### 決定理由

学習目的のプロジェクトとして、以下を重視：
- ACLの核心的なロジック（エントリーによる権限制御）に集中
- シンプルで理解しやすい実装
- 各権限管理方式の特徴を明確に区別

## 結果

### 利点
- コードが簡潔で、ACLの本質的な動作が理解しやすい
- 所有者概念を排除することで、純粋なエントリーベースの権限制御を学習
- テストケースがシンプルになる
- Unix権限との明確な差別化

### トレードオフ
- 実システムとは異なる簡略化された設計
- 複数リソースを扱う場合の追加実装が必要
- 所有者による管理権限の保証がない

### 今後の課題
- 複数リソースを扱う場合のパターン例の提供
- 所有者のロックアウト防止のベストプラクティス文書化