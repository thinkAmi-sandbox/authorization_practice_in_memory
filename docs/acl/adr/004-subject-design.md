# ADR-004: 主体設計 - 構造化型とnameフィールドの採用

## ステータス
- **日付**: 2025-08-21
- **状態**: 承認
- **決定者**: プロジェクトチーム

## コンテキスト

ACLシステムでは、権限を付与する対象（主体/Subject）をどのように表現するかが重要である。主体にはユーザーとグループがあり、これらを型安全かつ拡張可能な方法で表現する必要がある。

また、主体を識別するフィールド名の選択（idかnameか）も、システムの理解しやすさに影響する。

## 検討したオプション

### オプション1: 文字列結合形式
```typescript
subject: "user:alice" | "group:admin"
```

- **利点**:
  - シンプルで簡潔
  - 文字列ベースで扱いやすい
  - ACLの設定ファイルなどでよく見られる形式

- **欠点**:
  - 型安全性が低い（任意の文字列を受け入れる可能性）
  - パースが必要
  - 拡張性が低い（新しい主体タイプの追加が困難）

### オプション2: 構造化された型
```typescript
subject: { type: 'user' | 'group', name: string }
```

- **利点**:
  - 型安全（typeフィールドで主体の種類を明確に区別）
  - 拡張性が高い（新しいフィールドや主体タイプを追加しやすい）
  - パース不要
  - IDEのサポートが充実

- **欠点**:
  - やや冗長
  - オブジェクトのため比較がやや複雑

## 決定

**構造化された型（オプション2）**を採用し、識別子には**nameフィールド**を使用する。

```typescript
export type Subject = {
  type: 'user' | 'group'
  name: string
}
```

### nameフィールドを選択した理由

`id`ではなく`name`を選択した理由：

1. **教育的観点**: 学習目的のプロジェクトでは、`name`の方が直感的で理解しやすい
2. **可読性**: テストコードやデバッグ時に、`alice`や`developers`といった名前の方が意図が明確
3. **実装の簡潔性**: IDとnameのマッピングテーブルが不要

## 結果

### 利点
- TypeScriptの型システムで完全な型安全性を実現
- 将来的に`role`や`service`などの新しい主体タイプを追加可能
- コードの可読性と保守性が向上
- 学習者にとって理解しやすい設計

### トレードオフ
- オブジェクトの比較時に深い比較が必要
- メモリ使用量がわずかに増加

### 今後の課題
- 主体の比較用ヘルパー関数の実装
- 新しい主体タイプ追加時のガイドライン作成