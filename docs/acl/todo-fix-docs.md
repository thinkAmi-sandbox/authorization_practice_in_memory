# TODO: ACL ドキュメント再構成タスク

## 目的
現在の `docs/adr-acl-design.md` （765行）と `docs/acl.md` （初期実装案）をマージし、Design DocとADRに分離して整理する。

## 採用する構造（ReBACと同様のカテゴリ別ADR分類）

```
docs/
├── acl/
│   ├── README.md                      # 全体概要とナビゲーション
│   ├── design-doc.md                  # 詳細な技術設計書（初期実装案をマージ）
│   ├── adr/
│   │   ├── README.md                  # ADR一覧と決定の要約
│   │   ├── 001-entry-type.md          # エントリー型：Tagged Union方式
│   │   ├── 002-evaluation-mode.md     # 評価方式：Deny優先型
│   │   ├── 003-permission-patterns.md # 権限パターン：Branded Types
│   │   ├── 004-subject-design.md      # 主体設計：構造化型とnameフィールド
│   │   ├── 005-resource-scope.md      # リソース範囲：1インスタンス1リソース
│   │   └── 006-api-design.md          # API設計：最小限の3メソッド
│   └── examples.md                    # 実装例とコードサンプル
└── [既存ファイル]
```

## 作業タスク

### Phase 1: ディレクトリ構造の作成
- [ ] `docs/acl/` ディレクトリ作成
- [ ] `docs/acl/adr/` ディレクトリ作成
- [x] `docs/acl/todo-fix-docs.md` 作成（このファイル）

### Phase 2: 元ファイルの内容整理
現在の `docs/adr-acl-design.md` と `docs/acl.md` から以下の内容を抽出・整理：

#### ADRファイルへの分割（各ファイルは簡潔に、2-3ページ以内）

- [ ] **001-entry-type.md**
  - 3.2節: エントリー型の設計（deny フィールド方式 vs Tagged Union方式）
  - 4.1.2節: Tagged UnionによるEntry型の決定
  - 型安全性と意図の明確化

- [ ] **002-evaluation-mode.md**
  - 3.7節: 評価方式の選択（順序依存型 vs Deny優先型）
  - 4.1.6節: Deny優先型の評価方式の採用
  - 4.1.6.1-4.1.6.4節: 同一主体への重複設定の扱い

- [ ] **003-permission-patterns.md**
  - 3.6節: 権限パターンの型安全性の課題
  - 4.1.8節: Branded Typesによる権限パターンの型安全性
  - 7.3節: Branded Typesの実行時への影響

- [ ] **004-subject-design.md**
  - 3.1.1節: 文字列結合形式 vs 構造化された型
  - 3.1.3節: Subject型の設計（id vs name）
  - 4.1.3節: 構造化されたSubject型（type + name）の決定

- [ ] **005-resource-scope.md**
  - 3.1.2節: 複数リソース管理 vs 1インスタンス1リソース
  - 3.4節: 所有者の扱い（所有者特権あり vs 純粋なACL）
  - 4.1.1節: 1インスタンス1リソース設計の決定
  - 4.1.5節: 純粋なACL（所有者特権なし）の決定

- [ ] **006-api-design.md**
  - 4.2節: メソッドシグネチャ
  - 4.2.1節: resolveAccessメソッド名の選定経緯
  - 4.2.2節: エントリー管理メソッド群（最小限）
  - 5.1.3節: 最小限設計の採用理由

#### Design Docへの集約
- [ ] **design-doc.md**
  - 初期実装案（`docs/acl.md`）の内容を統合
  - 2節: コンテキスト全体（プロジェクト背景、ACLの位置づけ、想定する題材）
  - 5節: 理由と根拠の詳細
  - 6節: 結果と影響
  - 8節: 参考情報

#### 実装例の整理
- [ ] **examples.md**
  - 初期実装案のコード例
  - 7節: 実装例全体
  - 7.1節: 型定義の完全なコード
  - 7.2節: クラスとヘルパー関数
  - 7.4節: 使用例（最小限）
  - 7.5節: AccessDecisionの各ケースの例

### Phase 3: メタファイルの作成
- [ ] **docs/acl/README.md**
  - ACLドキュメントの概要
  - Unix権限からの発展（固定的な3主体から任意数の主体へ）
  - 各ファイルへのナビゲーション
  - 学習パスの提示

- [ ] **docs/acl/adr/README.md**
  - ADR一覧（6つのADR）
  - 各決定事項の要約
  - 決定間の関連性
  - 重要度の表示

### Phase 4: 既存ファイルの処理
- [ ] `docs/adr-acl-design.md` をアーカイブまたは削除（確認後）
- [ ] `docs/acl.md` を削除（内容はdesign-doc.mdに統合済み）

## ADRテンプレート

各ADRファイルは以下の形式で記述：

```markdown
# ADR-XXX: [タイトル]

## ステータス
- **日付**: 2025-08-XX
- **状態**: 承認
- **決定者**: プロジェクトチーム

## コンテキスト
[なぜこの決定が必要か、簡潔な背景]

## 検討したオプション

### オプション1: [名前]
- 利点: ...
- 欠点: ...

### オプション2: [名前]
- 利点: ...
- 欠点: ...

## 決定
[選択したオプション]を採用する。

[簡潔な理由]

## 結果
- **利点**: ...
- **トレードオフ**: ...
- **今後の課題**: ...
```

## 注意事項

1. **ADRは簡潔に**: 各ADRは1つの決定事項に集中し、2-3ページ以内に収める
2. **Design Docは詳細に**: 技術的な詳細、実装の説明、概念の解説はDesign Docに集約
3. **初期実装案の統合**: `docs/acl.md`の内容を適切にdesign-doc.mdに組み込む
4. **実装例は独立**: コードサンプルはexamples.mdに整理し、ADRからは参照のみ
5. **相互参照**: 各ドキュメント間で適切に相互参照を設定
6. **ReBACとの一貫性**: ReBACドキュメント構造と同様の構成を維持

## 完了基準

- [ ] すべてのファイルが作成され、内容が適切に分割されている
- [ ] 各ADRが独立して理解可能
- [ ] Design Docが包括的な技術説明を提供（初期実装案を含む）
- [ ] README.mdによるナビゲーションが機能している
- [ ] 元の長大なファイルと初期実装案が適切に処理されている

## 備考

このタスクは、ACLの学習と実装を進める中で蓄積された知識を、より管理しやすく、参照しやすい形に再構成するものである。特に：

1. **初期実装案の統合**: `docs/acl.md`にある初期の設計アイデアを、最終的な設計決定と統合してdesign-doc.mdに反映する
2. **決定事項の分離**: 複数の設計決定が混在していた元のファイルを、各決定事項ごとに独立したADRとして分離
3. **学習効果の向上**: Deny優先型、Tagged Union、Branded Typesなど、実際の認可ライブラリで使われるパターンの学習を促進
4. **ReBACとの一貫性**: プロジェクト全体でドキュメント構造を統一し、ナビゲーションを改善