# ABAC Architecture Decision Records

## 概要

このディレクトリには、ABAC（属性ベースアクセス制御）実装における重要な設計決定を記録したADR（Architecture Decision Records）が含まれています。各ADRは独立して理解可能で、特定の設計課題に対する決定とその根拠を文書化しています。

## ADR一覧

### [ADR-001: ポリシー言語の設計](./001-policy-language.md)
**決定**: 関数ベースの条件記述を採用

**理由**:
- TypeScriptの型システムを活用した型安全性
- デバッグとテストの容易さ
- 学習用途での理解しやすさ

**影響**: シンプルで直感的なポリシー記述が可能、ただしDSLに比べて表現力は限定的

---

### [ADR-002: 属性システムの設計](./002-attribute-system.md)
**決定**: カテゴリー別の厳密な属性システム

**構造**:
- Subject（主体）、Resource（リソース）、Action（操作）、Environment（環境）の4カテゴリー
- 各カテゴリーで明確に型定義された属性
- 意図的な重複設計（学習効果のため）

**影響**: 属性の役割が明確で学習しやすい、実装は冗長だが教育的価値が高い

---

### [ADR-003: 評価結果の設計](./003-evaluation-result.md)
**決定**: Tagged Unionパターンによる詳細な評価結果

**結果タイプ**:
- `permit`: アクセス許可（マッチしたルール情報を含む）
- `deny`: アクセス拒否（拒否理由を含む）
- `not-applicable`: ポリシー非適用（理由を含む）

**影響**: デバッグと監査が容易、エラー分析が詳細に可能

---

### [ADR-004: Deny機能のサポート](./004-deny-support.md)
**決定**: 明示的なDenyの必須サポート

**RBACとの違い**:
- RBACではDenyはオプショナル（ロールの除外で対応可能）
- ABACではDenyが必須（属性の動的評価で除外が困難）

**用語選定**: `permit`/`deny`（XACML標準に準拠）

**影響**: セキュリティとコンプライアンス要件への対応が強化

---

### [ADR-005: 競合解決戦略](./005-conflict-resolution.md)
**決定**: Deny-Override戦略の採用

**評価順序**:
1. すべてのポリシーを評価
2. 一つでもDenyがあれば即座に拒否
3. Permitのみの場合に許可
4. どちらもマッチしない場合はnot-applicable

**影響**: セキュリティ重視の設計、業界標準（XACML）との整合性

---

### [ADR-006: API設計](./006-api-design.md)
**決定**: 最小限のAPI（3メソッドのみ）

**インターフェース**:
- `addPolicy()`: ポリシー追加
- `removePolicy()`: ポリシー削除
- `evaluate()`: アクセス評価

**メソッド名**: `evaluate`（業界標準の用語）

**影響**: 学習の焦点が明確、実装がシンプル

## 決定間の関連性

### 依存関係の流れ

```
ポリシー言語（ADR-001）
    ↓
属性システム（ADR-002）
    ↓
評価結果（ADR-003）
    ↓
Deny機能（ADR-004）
    ↓
競合解決（ADR-005）
    ↓
API設計（ADR-006）
```

### 相互補完関係

- **ADR-001 + ADR-002**: 関数ベースのポリシーが厳密な属性システムを前提
- **ADR-003 + ADR-004**: Tagged UnionがDeny理由の詳細記録を可能に
- **ADR-004 + ADR-005**: Deny機能がDeny-Override戦略を必然化
- **ADR-005 + ADR-006**: 競合解決戦略がevaluate()メソッドの振る舞いを定義

## RBACとの主要な差異

| 決定事項 | RBAC | ABAC |
|---------|------|------|
| 権限の表現 | ロール-権限マッピング | ポリシー（条件式） |
| 評価タイミング | 事前（ロール割当時） | 実行時（アクセス時） |
| Deny機能 | オプション | **必須**（ADR-004） |
| 競合解決 | 単純（ロール優先順位） | **複雑**（ADR-005） |
| API複雑度 | 多数のメソッド | **最小限**（ADR-006） |

## ReBACへの発展の道筋

ABACの設計決定は、ReBACへの自然な発展を可能にします：

1. **属性の拡張性**（ADR-002）
   - 関係性を特殊な属性として扱うことが可能
   - カテゴリー構造がグラフノードへマッピング可能

2. **評価エンジンの再利用**（ADR-003, ADR-005）
   - Tagged Unionパターンは関係性評価でも有効
   - Deny-Override戦略は関係性ベースでも適用可能

3. **APIの進化**（ADR-006）
   - evaluateメソッドを関係性トラバーサルに拡張可能
   - 最小限設計により、新機能追加が容易

## 学習上の重要ポイント

### 概念理解の優先順位

1. **最重要**: ADR-004（Deny機能）- ABACの本質的な特徴
2. **重要**: ADR-005（競合解決）- 実用上必須の知識
3. **基礎**: ADR-002（属性システム）- ABACの基本構造
4. **実装**: ADR-001, ADR-003, ADR-006 - 具体的な実装方針

### 実装時の推奨順序

1. ADR-002: 属性システムの実装
2. ADR-001: ポリシー構造の定義
3. ADR-003: 評価結果の型定義
4. ADR-004: Deny機能の組み込み
5. ADR-005: 競合解決ロジック
6. ADR-006: 公開APIの実装

## まとめ

これらのADRは、ABACの学習用実装における設計決定を体系的に記録しています。各決定は：

- **独立性**: 個別に理解可能
- **一貫性**: 全体として調和
- **教育的価値**: 概念理解を重視
- **実用性**: 実際のユースケースに対応

特に、RBACからの発展として位置づけることで、なぜこれらの決定が必要なのかを明確にし、さらにReBACへの橋渡しとなる設計を意識しています。