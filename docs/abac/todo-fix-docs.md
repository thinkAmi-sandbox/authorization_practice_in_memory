# TODO: ABAC ドキュメント再構成タスク

## 目的
現在の `docs/adr-abac-design.md` （約2000行の長大なファイル）を、Design DocとADRに分離して整理する。

## 採用する構造（ReBACと同じパターン）

```
docs/
├── abac/
│   ├── README.md                        # 全体概要とナビゲーション
│   ├── design-doc.md                    # 詳細な技術設計書
│   ├── adr/
│   │   ├── README.md                    # ADR一覧と決定の要約
│   │   ├── 001-policy-language.md       # ポリシー言語：関数ベース vs DSL
│   │   ├── 002-attribute-system.md      # 属性システム：型安全性と構造
│   │   ├── 003-evaluation-result.md     # 評価結果：Tagged Union設計
│   │   ├── 004-deny-support.md          # Deny機能：明示的拒否の必要性
│   │   ├── 005-conflict-resolution.md   # 競合解決：Deny-Override戦略
│   │   └── 006-api-design.md            # API設計：最小限のインターフェース
│   ├── examples.md                      # 実装例とコードサンプル
│   └── test-strategy.md                 # テスト戦略と学習効果
└── [他の既存ファイル]
```

## 作業タスク

### Phase 1: ディレクトリ構造の作成
- [x] `docs/abac/` ディレクトリ作成
- [x] `docs/abac/adr/` ディレクトリ作成
- [x] `docs/abac/todo-fix-docs.md` 作成（このファイル）

### Phase 2: 元ファイルの内容整理
現在の `docs/adr-abac-design.md` から以下の内容を抽出・整理：

#### ADRファイルへの分割（各ファイルは簡潔に）
- [x] **001-policy-language.md**
  - 3.1節: ポリシー言語の設計（DSL vs JSON vs コード埋め込み）
  - 4.1.1節: 関数ベースの条件記述の決定
  - 実装例と具体的な使用方法

- [x] **002-attribute-system.md**
  - 3.2節: 属性の型システム（型安全性 vs 柔軟性）
  - 3.2.2節: 属性の意図的な重複設計
  - 3.2.3節: 属性の最小化（学習用途最適化）
  - 3.2.4節: 識別子の学習用最適化
  - 2.7節: 属性のカテゴリー構造と文脈の明確化
  - 4.1.2節: 厳密な属性システムの採用決定

- [x] **003-evaluation-result.md**
  - 3.3節: 評価結果の設計（Simple vs Detailed）
  - 3.3.2節: not-applicableのreasonフィールド設計
  - 3.3.3節: 複数ポリシーマッチ時のルール選択
  - 3.6節: not-applicableの扱い
  - 4.1.3節: Tagged Union採用の決定

- [x] **004-deny-support.md**
  - 3.5節: Deny機能の必要性（RBACとABACの根本的な違い）
  - 3.4節: Effect用語選定（permit vs allow）
  - 3.6.3節: Denyポリシーのみの場合の挙動
  - 4.1.4節: 明示的なDenyのサポート決定

- [x] **005-conflict-resolution.md**
  - 3.7節: 競合解決戦略（複数ルールマッチ時の処理）
  - 3.7.2節: Deny-Override戦略の詳細な評価ルール
  - 3.8節: ポリシーの組み合わせ設計
  - 4.1.5節: Deny-Override競合解決戦略の採用

- [x] **006-api-design.md**
  - 3.9節: APIの設計（最小限 vs 完全）
  - 4.1.6節: 最小限のAPI設計の採用
  - 4.2節: メソッド名の選定理由（evaluate）

#### Design Docへの集約
- [x] **design-doc.md**
  - 2節: コンテキスト全体
    - 2.1節: プロジェクトの背景
    - 2.2節: ABACの位置づけ（RBACからの発展）
    - 2.3節: 想定する題材（社内ドキュメント管理システム）
    - 2.4節: RBACとABACの中心概念の違い
    - 2.5節: ABACの核心概念の学習
    - 2.6節: ポリシー評価エンジンのアーキテクチャ詳細
    - 2.8節: 実際のABACライブラリの実装パターン
    - 2.9節: 権限管理モデルの進化における位置づけ
  - 5節: 理由と根拠（学習効果、トレードオフ）
  - 7節: 結果と影響

#### 独立ファイルとして整理
- [x] **examples.md**
  - 6節: 実装例全体
  - 6.1節: 基本的なポリシー定義
  - 6.2節: 評価エンジンの使用例
  - 6.3節: 複合条件の例
  - 6.4節: テスト例

- [x] **test-strategy.md**
  - 8節: テスト戦略全体
  - 8.1節: テスト構造の設計方針
  - 8.2節: 推奨するテスト構成
  - 8.3節: 各テストカテゴリーの学習効果
  - 8.4節: 実装上の考慮事項
  - 8.5節: 統合テスト
  - 10節: テストレビューと対応方針

### Phase 3: メタファイルの作成
- [x] **docs/abac/README.md**
  - ABACドキュメントの概要
  - 各ファイルへのナビゲーション
  - RBACからの発展としての位置づけ
  - ReBACへの橋渡しとしての役割

- [x] **docs/abac/adr/README.md**
  - ADR一覧
  - 各決定事項の要約
  - 決定間の関連性
  - RBACとの差異、ReBACへの発展の道筋

### Phase 4: 既存ファイルの処理
- [x] `docs/adr-abac-design.md` をアーカイブ（docs/archive/へ移動済み）
- [x] 参考情報（9節）をdesign-doc.mdへ統合済み

## ADRテンプレート

各ADRファイルは以下の形式で記述：

```markdown
# ADR-XXX: [タイトル]

## ステータス
- **日付**: 2025-08-XX
- **状態**: 承認
- **決定者**: プロジェクトチーム

## コンテキスト
[なぜこの決定が必要か、簡潔な背景]

## 検討したオプション

### オプション1: [名前]
- 利点: ...
- 欠点: ...

### オプション2: [名前]
- 利点: ...
- 欠点: ...

## 決定
[選択したオプション]を採用する。

[簡潔な理由]

## 結果
- **利点**: ...
- **トレードオフ**: ...
- **今後の課題**: ...
```

## 注意事項

1. **ADRは簡潔に**: 各ADRは1つの決定事項に集中し、2-3ページ以内に収める
2. **Design Docは詳細に**: 技術的な詳細、実装の説明、概念の解説はDesign Docに集約
3. **実装例は独立**: コードサンプルはexamples.mdに整理し、ADRからは参照のみ
4. **相互参照**: 各ドキュメント間で適切に相互参照を設定
5. **RBACとの対比**: ABACの理解を深めるため、RBACとの違いを明確に記述
6. **学習効果重視**: 実務的な完全性よりも、概念理解と学習効果を優先

## 完了基準

- [x] すべてのファイルが作成され、内容が適切に分割されている
- [x] 各ADRが独立して理解可能
- [x] Design Docが包括的な技術説明を提供
- [x] テスト戦略が独立したドキュメントとして整理されている
- [x] README.mdによるナビゲーションが機能している
- [x] 元の長大なファイルが適切に処理されている

## 完了報告

**2025-08-20**: すべてのタスクが完了しました。

- 元の2000行のファイルを12個の管理しやすいファイルに分割
- ReBACと同じディレクトリ構造を採用
- 各ADRは100-150行、Design Docは約500行に収束
- 学習効果を重視した構成で再編成完了

## ABACドキュメント固有の考慮事項

### RBACからの発展を明確化
- RBACの「ロール中心」から「属性中心」への転換を強調
- 静的な権限割り当てから動的な評価への移行を説明
- ポリシーという新しい概念の導入理由を明確に

### ポリシー評価エンジンの重要性
- ABACの核心はポリシー評価エンジンであることを強調
- PEP、PDP、PIP、PAPの4コンポーネントの役割を明確に
- 学習用実装での簡略化ポイントを明示

### Deny機能の特別な位置づけ
- RBACではオプショナルだったDenyがABACでは必須である理由
- Deny-Override戦略の必然性
- セキュリティ観点からの重要性

### ReBACへの発展の道筋
- 属性評価から関係性評価への自然な発展
- グラフ構造導入の必然性
- ABACで学んだ概念がReBACでどう活かされるか

## 備考

このタスクは、ABACの学習と実装を通じて蓄積された知識を、より管理しやすく、参照しやすい形に再構成するものである。特に、ポリシー評価エンジンという核心概念を中心に、各設計決定を独立したADRとして整理することで、ABACの本質的な理解を促進し、RBACからの発展とReBACへの橋渡しを明確にする。