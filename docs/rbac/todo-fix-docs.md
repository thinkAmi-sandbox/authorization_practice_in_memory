# TODO: RBAC ドキュメント再構成タスク

## 目的
現在の `docs/adr-rbac-design.md` （1151行の長大なファイル）を、Design DocとADRに分離して整理する。

## 採用する構造

```
docs/
├── rbac/
│   ├── README.md                        # 全体概要とナビゲーション
│   ├── design-doc.md                    # 詳細な技術設計書
│   ├── adr/
│   │   ├── README.md                    # ADR一覧と決定の要約
│   │   ├── 001-role-model.md            # ロールモデル：グローバル管理と2層アーキテクチャ
│   │   ├── 002-role-hierarchy.md        # ロール階層：階層なしのフラット設計
│   │   ├── 003-multiple-roles.md        # 複数ロール：ユーザーの複数ロール割り当て
│   │   ├── 004-permission-evaluation.md # 権限評価：OR演算による統合
│   │   ├── 005-deny-policy.md          # Deny機能：実装しない決定と理由
│   │   └── 006-api-design.md           # API設計：最小限のメソッドセット
│   ├── library-comparison.md            # 主要ライブラリの調査結果
│   └── examples.md                      # 実装例とコードサンプル
└── adr-rbac-design.md                  # 元ファイル（後でアーカイブ）
```

## 作業タスク

### Phase 1: ディレクトリ構造の作成
- [ ] `docs/rbac/` ディレクトリ作成
- [ ] `docs/rbac/adr/` ディレクトリ作成
- [ ] `docs/rbac/todo-fix-docs.md` 作成（このファイル）

### Phase 2: 元ファイルの内容整理
現在の `docs/adr-rbac-design.md` から以下の内容を抽出・整理：

#### ADRファイルへの分割（各ファイルは簡潔に）

- [ ] **001-role-model.md**
  - 3.1節: ロールの表現方法（オプション1-4の比較）
  - 3.2.2節: ロール管理のスコープ（リソース単位 vs グローバル）
  - 4.1.1節: グローバルロール管理と2層アーキテクチャの決定

- [ ] **002-role-hierarchy.md**
  - 3.1.3節: ロール階層の扱い（113-265行）
  - 主要ライブラリにおけるロール階層のサポート状況
  - 階層なしを選択した理由（学習効果の最適化）

- [ ] **003-multiple-roles.md**
  - 3.2.1節: 単一ロール vs 複数ロール
  - 4.1.3節: 複数ロール割り当て可能の決定
  - 権限の統合ロジック（OR演算）

- [ ] **004-permission-evaluation.md**
  - 3.5節: 権限評価ロジックの実装方法
  - 4.1.6節: API設計（authorize/evaluatePermissions）
  - 4.1.7節: 学習用実装における設計の簡潔性

- [ ] **005-deny-policy.md**
  - 3.4節: Deny機能の必要性（321-484行）
  - 3.4.1節: ACLとの根本的な違い
  - 3.4.2節: RBACにDenyが不要な理由
  - 3.4.6節: 実際のライブラリにおけるDenyサポート状況（409-483行）

- [ ] **006-api-design.md**
  - 3.6節: APIの設計（最小限、中程度、完全）
  - 4.1.6節: 採用したAPI設計
  - RoleManagerとRbacProtectedResourceのAPI

#### Design Docへの集約

- [ ] **design-doc.md**
  - 2節: コンテキスト全体
    - 2.1節: プロジェクトの背景
    - 2.2節: RBACの位置づけ（ACLからの発展）
    - 2.3節: 想定する題材（社内ドキュメント管理システム）
    - 2.4節: RBACの核心概念の学習
  - 4.2節: 型定義の詳細
  - 4.3節: 型安全な設計の利点
  - 4.4節: ACLとの本質的な違い
  - 5節: 理由と根拠
  - 6節: 結果と影響
  - 8節: テスト戦略

#### ライブラリ比較の独立

- [ ] **library-comparison.md**
  - Spring Security、Casbin、Keycloak等の階層サポート状況
  - CASL、Pundit、CanCanCan等のDenyサポート状況
  - 各ライブラリの特徴と学習曲線の比較表

#### 実装例の整理

- [ ] **examples.md**
  - 7節: 実装例全体
  - 7.1節: 基本的な使用例
  - 7.2節: 複数ロールの統合例
  - 7.3節: 組織変更のシミュレーション
  - 7.4節: ACLとの比較例

### Phase 3: メタファイルの作成

- [ ] **docs/rbac/README.md**
  - RBACドキュメントの概要
  - 各ファイルへのナビゲーション
  - 学習パスの提示

- [ ] **docs/rbac/adr/README.md**
  - ADR一覧
  - 各決定事項の要約
  - 決定間の関連性

### Phase 4: 既存ファイルの処理

- [ ] `docs/adr-rbac-design.md` の内容移行確認
- [ ] `docs/adr-rbac-design.md` をアーカイブまたは削除（確認後）

## ADRテンプレート

各ADRファイルは以下の形式で記述：

```markdown
# ADR-XXX: [タイトル]

## ステータス
- **日付**: 2025-08-12
- **状態**: 承認
- **決定者**: プロジェクトチーム

## コンテキスト
[なぜこの決定が必要か、簡潔な背景]

## 検討したオプション

### オプション1: [名前]
- 利点: ...
- 欠点: ...

### オプション2: [名前]
- 利点: ...
- 欠点: ...

## 決定
[選択したオプション]を採用する。

[簡潔な理由]

## 結果
- **利点**: ...
- **トレードオフ**: ...
- **今後の課題**: ...
```

## 注意事項

1. **ADRは簡潔に**: 各ADRは1つの決定事項に集中し、2-3ページ以内に収める
2. **Design Docは詳細に**: 技術的な詳細、実装の説明、概念の解説はDesign Docに集約
3. **実装例は独立**: コードサンプルはexamples.mdに整理し、ADRからは参照のみ
4. **相互参照**: 各ドキュメント間で適切に相互参照を設定
5. **一貫性**: ReBACドキュメント構造と同じパターンを使用

## 完了基準

- [ ] すべてのファイルが作成され、内容が適切に分割されている
- [ ] 各ADRが独立して理解可能
- [ ] Design Docが包括的な技術説明を提供
- [ ] README.mdによるナビゲーションが機能している
- [ ] 元の長大なファイルが適切に処理されている
- [ ] ReBACドキュメント構造との一貫性が保たれている

## 備考

このタスクは、RBACの学習と実装を進める中で蓄積された知識を、より管理しやすく、参照しやすい形に再構成するものである。特に、複数の設計決定が混在していた元のファイルを、各決定事項ごとに独立したADRとして分離することで、将来の設計変更や追加決定の際の影響範囲を明確にする。

ReBACドキュメントの再構成と同じ構造を採用することで、プロジェクト全体の一貫性を保ち、学習者にとって予測可能なドキュメント構造を提供する。