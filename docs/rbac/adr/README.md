# RBAC アーキテクチャ決定記録（ADR）

## 概要

このディレクトリには、RBAC実装における重要な設計決定を記録したADR（Architecture Decision Records）が含まれています。各ADRは独立して理解可能で、特定の設計上の課題とその解決策を文書化しています。

## ADR一覧

| ADR | タイトル | 決定 | ステータス |
|-----|---------|------|-----------|
| [001](./001-role-model.md) | ロールモデル | グローバル管理と2層アーキテクチャ | 承認 |
| [002](./002-role-hierarchy.md) | ロール階層 | 階層なしのフラット設計 | 承認 |
| [003](./003-multiple-roles.md) | 複数ロール | ユーザーの複数ロール割り当て許可 | 承認 |
| [004](./004-permission-evaluation.md) | 権限評価 | OR演算による統合 | 承認 |
| [005](./005-deny-policy.md) | Deny機能 | 実装しない（ポジティブモデル） | 承認 |
| [006](./006-api-design.md) | API設計 | 最小限のメソッドセット | 承認 |

## 決定の要約

### ADR-001: ロールモデル
- **決定**: const assertion + typeof によるロール表現とグローバルロール管理
- **理由**: 型安全性とIDE補完、一元管理による一貫性
- **影響**: RoleManagerとRbacProtectedResourceの2層構造

### ADR-002: ロール階層
- **決定**: 階層なしのフラット構造
- **理由**: RBACの本質に集中、実装のシンプルさ、段階的学習
- **影響**: 権限定義の重複が発生するが、理解しやすい

### ADR-003: 複数ロール
- **決定**: ユーザーは複数のロールを同時に保持可能
- **理由**: 実際の組織構造を反映、柔軟な権限設定
- **影響**: OR演算による権限統合ロジックが必要

### ADR-004: 権限評価
- **決定**: RbacProtectedResourceのメソッドとして実装、OR演算で統合
- **理由**: シンプルな設計、直感的な動作
- **影響**: 業界標準の`authorize`メソッド名を採用

### ADR-005: Deny機能
- **決定**: Denyを実装しない、ポジティブ権限モデル
- **理由**: RBACの本質（できることの定義）、管理の簡素化
- **影響**: 例外的な権限制限には別のロール設計が必要

### ADR-006: API設計
- **決定**: 中程度のAPIセット（5メソッド程度）
- **理由**: 学習に最適、基本操作を網羅、業界標準準拠
- **影響**: assignRole/revokeRole/getUserPermissions等の基本API

## 決定間の関連性

```
ADR-001（グローバル管理）
    ↓
    基盤となる
    ↓
ADR-002（フラット構造）── 簡素化 ──→ ADR-005（Denyなし）
    ↓
    前提となる
    ↓
ADR-003（複数ロール）
    ↓
    必要とする
    ↓
ADR-004（OR演算統合）
    ↓
    実装される
    ↓
ADR-006（API設計）
```

## 設計原則

すべてのADRは以下の原則に基づいています：

1. **学習効果の最大化**: RBACの本質的な概念を理解しやすくする
2. **シンプルさ優先**: 不要な複雑性を排除
3. **型安全性**: TypeScriptの機能を活用してエラーを防ぐ
4. **業界標準準拠**: 実務で使われる用語とパターンを採用
5. **段階的学習**: 基本から応用へ順序立てて学べる設計

## 今後の拡張可能性

現在の決定は学習用に最適化されていますが、以下の拡張が可能です：

- **階層サポート**: ADR-002を見直してロール継承を追加
- **動的権限**: 時間や条件に基づく権限制御
- **制約機能**: 相互排他ロールなどの制約追加
- **ABACへの移行**: ロールを属性の一つとして扱う

## ADRの読み方

1. **順番に読む**: 001から順に読むことで、設計の全体像が理解できます
2. **個別に参照**: 特定の設計判断について知りたい場合は、該当するADRを直接参照
3. **比較して読む**: ACLやABACの同番号ADRと比較すると、各方式の違いが明確になります

## 更新履歴

- 2025-08-12: 初版作成（ADR-001〜006）