# ADR-006: 機能範囲 - Deny機能なし、基本機能のみ

## ステータス
- **日付**: 2025-08-14
- **状態**: 承認
- **決定者**: プロジェクトチーム

## コンテキスト

ReBACシステムの機能範囲を決定する必要がある。特に、明示的な拒否（Deny）機能をサポートするかどうかは重要な設計決定である。

## 検討したオプション

### Deny機能について

#### オプション1: Deny機能をサポート
```typescript
type RelationType = 
  | 'owns' | 'manages' | 'memberOf' | 'viewer' | 'editor'  // ポジティブ
  | 'blocked' | 'restricted' | 'suspended'                  // ネガティブ
```
- 利点：きめ細かいアクセス制御
- 欠点：グラフ探索の複雑化、競合解決が必要、性能への影響

#### オプション2: Deny機能なし（Zanzibar型）
```typescript
type RelationType = 'owns' | 'manages' | 'memberOf' | 'viewer' | 'editor'
```
- 利点：シンプル、デバッグが容易、業界標準（Zanzibar）準拠
- 欠点：明示的な拒否ができない

## 決定

**オプション2: Deny機能なし（Zanzibar型）**を採用

### 採用理由

1. **概念の純粋性**: ReBACの本質（関係性ベースの権限導出）に集中
2. **実装の単純性**: グラフ探索アルゴリズムが直感的
3. **デバッグの容易さ**: 権限の根拠（関係パス）が明確
4. **業界標準準拠**: Google Zanzibar、SpiceDBと同様のアプローチ

### 主要ReBACシステムのDenyサポート状況

- **Google Zanzibar**: Denyサポートなし（Default Deny）
- **SpiceDB**: Denyサポートなし（Zanzibar準拠）
- **OpenFGA**: 限定的サポート（difference演算子）
- **Ory Keto**: 実験的サポート

### Denyが必要な場合の代替手法

1. **関係の削除**: 権限を取り消す場合は関係を削除
2. **グループからの除外**: グループメンバーシップを削除
3. **個別権限への移行**: グループ権限から個別権限へ変更

## 結果

### 利点
- 学習しやすい単純な権限モデル
- グラフ理論の純粋な適用
- 高い性能と予測可能な動作
- 実システムへの移行が容易

### トレードオフ
- 明示的な拒否ができない
- きめ細かい制御には工夫が必要

### 今後の課題
- Phase 2として否定的関係の追加を検討
- 条件付き関係の実装
- ABAC的な条件との組み合わせ