# ADR-001: コアモデル - 関係性タプルとグラフ構造

## ステータス
- **日付**: 2025-08-14
- **状態**: 承認
- **決定者**: プロジェクトチーム

## コンテキスト

ReBACシステムの基盤となるデータモデルを決定する必要がある。エンティティ間の関係性を表現し、効率的に探索できる構造が求められる。

## 検討したオプション

### 1. 関係性の表現方法

#### オプション1: タプル配列
```typescript
type RelationTuple = [string, string, string]
// ["alice", "owns", "document1"]
```
- 利点：シンプル、メモリ効率的
- 欠点：型安全性が低い、可読性が劣る

#### オプション2: オブジェクト形式
```typescript
interface RelationTuple {
  subject: EntityId
  relation: RelationType
  object: EntityId
}
```
- 利点：型安全、自己文書化、IDE支援
- 欠点：若干冗長

### 2. グラフ構造の実装

#### オプション1: 隣接リスト
```typescript
type AdjacencyList = Map<EntityId, Map<RelationType, Set<EntityId>>>
```
- 利点：メモリ効率的、スパースグラフに適切、動的な追加削除が容易
- 欠点：特定の関係の存在確認がO(1)でない場合がある

#### オプション2: 隣接行列
```typescript
type AdjacencyMatrix = boolean[][][]  // [subject][relation][object]
```
- 利点：関係の存在確認がO(1)
- 欠点：メモリ使用量が多い、動的なサイズ変更が困難

## 決定

**関係性の表現**: オブジェクト形式を採用
- 学習用として概念が明確
- 型安全性とIDE支援により開発効率向上

**グラフ構造**: 隣接リストを採用
- 実際のReBACシステムに近い実装
- 関係の追加・削除が直感的
- グラフ理論の基本的なデータ構造を学習

## 結果

### 利点
- 型安全性により実行時エラーを削減
- 自己文書化されたコードによる学習効果
- 実システムへの適用が容易

### トレードオフ
- メモリ使用量は最適化されていない
- 大規模データでは性能の考慮が必要

### 今後の課題
- 逆方向の索引の実装
- キャッシュ戦略の検討